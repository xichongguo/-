import json
import requests

def main():
    # åŸå§‹ TVBox é…ç½®åœ°å€
    source_url = "http://cdn.qiaoji8.com/tvbox.json"
    
    # ä»£ç†åçš„ç›´æ’­æºåœ°å€
    live_url = "https://gh-proxy.com/https://raw.githubusercontent.com/xichongguo/live-stream/refs/heads/main/live/current.m3u8"
    
    print("ğŸ“¥ æ­£åœ¨è·å–åŸå§‹é…ç½®...")
    resp = requests.get(source_url)
    resp.raise_for_status()
    data = resp.json()

    # æ„é€ æ–°çš„ç›´æ’­åˆ†ç»„
    new_entry = {
        "group": "GitHub ç›´æ’­",
        "channels": [
            {
                "name": "xichongguo ç›´æ’­æº",
                "urls": [live_url]
            }
        ]
    }

    # ç¡®ä¿ lives å­˜åœ¨ä¸”ä¸ºåˆ—è¡¨
    if "lives" not in data or not isinstance(data["lives"], list):
        data["lives"] = []

    # æ’å…¥åˆ°æœ€å‰é¢ï¼ˆä¼˜å…ˆæ˜¾ç¤ºï¼‰
    data["lives"].insert(0, new_entry)

    # å†™å…¥æ–°æ–‡ä»¶
    output_file = "xichongys.json"
    with open(output_file, "w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

    print(f"âœ… å·²æˆåŠŸç”Ÿæˆæ–‡ä»¶ï¼š{output_file}")

if __name__ == "__main__":
    main()
